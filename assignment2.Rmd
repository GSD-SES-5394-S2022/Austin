---
title: "Assigment 2"
author: "Chris Dsida & Reuven Herzog"
date: "2/7/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
#load packages

library(tidycensus)
library(tidyverse)
library(units)
library(sf)
```

```{r}
#view ACS variables

varlist_2019acs5 <- load_variables(2019, "acs5")

geoidlist <- get_acs(geography = "metropolitan statistical area/micropolitan statistical area",
                     variables = "B19001_001",
                     year = 2019)
```
```{r}
inc_vars <- c(inc_lt_10k = 'B19001_002',
inc_btw_10k_15k = 'B19001_003',
inc_btw_15k_20k = 'B19001_004',
inc_btw_20k_25k = 'B19001_005',
inc_btw_25k_30k = 'B19001_006',
inc_btw_30k_35k = 'B19001_007',

inc_btw_35k_40k = 'B19001_008',
inc_btw_40k_45k = 'B19001_009',
inc_btw_45k_50k = 'B19001_010',
inc_btw_50k_60k = 'B19001_011',

inc_btw_60k_75k = 'B19001_012',
inc_btw_75k_100k = 'B19001_013',

inc_btw_100k_125k = 'B19001_014',
inc_btw_125k_150k = 'B19001_015',
	
inc_btw_150k_200k = 'B19001_016',
inc_gt_200k = 'B19001_017')



region_inc <- get_acs(
  geography = "metropolitan statistical area/micropolitan statistical area",
  variables = inc_vars,
  summary_var = 'B19001_001',
  geometry = FALSE) %>%
  filter(GEOID == "12420") %>%
  mutate(pct = estimate / summary_est) %>%
  mutate(cumul_pct = cumsum(pct)) %>%
  select(variable, cumul_pct)

# kable(region_inc, digits=2)
```

```{r}
vars <- c(hh_total = 'B11012_001',
hh_no_veh = 'B08201_002',
workers_total = 'B08203_001',
workers_no_veh = 'B08203_002',

housing_units = 'B25001_001',

hh_1person = 'B08201_007',
hh_2person = 'B08201_013',
hh_3person = 'B08201_019',
hh_4person_plus = 'B08201_025',

pop_under_18 = 'B09001_001',
pop_over_65 = 'B08101_008',

inc_lt_10k = 'B19001_002',
inc_btw_10k_15k = 'B19001_003',
inc_btw_15k_20k = 'B19001_004',
inc_btw_20k_25k = 'B19001_005',
inc_btw_25k_30k = 'B19001_006',
inc_btw_30k_35k = 'B19001_007',

inc_btw_35k_40k = 'B19001_008',
inc_btw_40k_45k = 'B19001_009',
inc_btw_45k_50k = 'B19001_010',
inc_btw_50k_60k = 'B19001_011',

inc_btw_60k_75k = 'B19001_012',
inc_btw_75k_100k = 'B19001_013',

inc_btw_100k_125k = 'B19001_014',
inc_btw_125k_150k = 'B19001_015',
	
inc_btw_150k_200k = 'B19001_016',
inc_gt_200k = 'B19001_017')

counties <- c("Travis", "Bastrop", "Hays", "Caldwell", "Williamson")
```

```{r}
#import tract-level data

census_data <- get_acs(geography = "tract",
                       state = "TX",
                       variables = vars,
                       county = counties,
                       output = "wide",
                       geometry = TRUE)
```

```{r}
#additional variable generation

census_data <- census_data %>%
  mutate(inc_quint_1 = inc_lt_10kE +
                       inc_btw_10k_15kE +
                       inc_btw_15k_20kE +
                       inc_btw_20k_25kE +
                       inc_btw_25k_30kE+
                       inc_btw_30k_35kE,
         inc_quint_2 = inc_btw_35k_40kE +
                       inc_btw_40k_45kE +
                       inc_btw_45k_50kE +
                       inc_btw_50k_60kE,
         inc_quint_3 = inc_btw_60k_75kE +
                       inc_btw_75k_100kE,
         inc_quint_4 = inc_btw_100k_125kE +
                       inc_btw_125k_150kE,
         inc_quint_5 = inc_btw_150k_200kE +
                       inc_gt_200kE)

census_data <- census_data %>%
  mutate(tract_area = st_area(geometry) %>%
  set_units("mi2"))

census_data <- census_data %>%
  mutate(res_density = housing_unitsE/tract_area)
```

