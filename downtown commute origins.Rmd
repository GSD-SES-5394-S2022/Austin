---
title: "Downtown Commutes"
author: "Reuven Herzog"
date: "2/7/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r load libraries}
library(lehdr)
library(tidycensus)
library(tidyverse)
library(units)
library(sf)
library(knitr)
library(PNWColors)

```

```{r lodes wac data}

#specify MSA tracts
MSA <- get_acs(geography = "tract", state = "TX", variables = "B19001_001",county = c("Travis","Bastrop","Caldwell","Hays","Williamson"), geometry = TRUE)
MSA_GEOIDS <- MSA$GEOID

#get Origin-Destination data for the cordoned census tracts
#austin, tx, tracts 7 and 11
#hahaha slurpees
lodes <- grab_lodes(state = "tx", year = 2019, lodes_type = "od", job_type = "JT00", 
           segment = "S000", state_part = "main", agg_geo = "tract") %>%
  filter(w_tract %in% c("48453001100","48453000700"), h_tract %in% MSA_GEOIDS)
  
```

```{r aggregate}
commute_origin <- lodes %>%
  select(w_tract, h_tract, S000) %>%
  group_by(h_tract) %>%
  rename(GEOID = h_tract) %>%
  summarize(commutes = sum(S000))
```

```{r join}
MSA <- left_join(MSA, commute_origin)
```



```{r visualize commutes}
commute_dens_map <- ggplot(MSA) +
  geom_sf(aes(fill = as.numeric(commutes)), color = NA) +
  scale_fill_viridis_c(name = "Commuters to Downtown")

commute_dens_map
```


