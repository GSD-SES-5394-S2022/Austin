---
title: "Assignment 5 graphics"
author: "Reuven Herzog"
date: "2/28/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

It's just easier to keep the accessibility skims and graphics separately, so we
can update in parallel if necessary.

```{r load libraries}
library(tidyverse)
library(here)
library(sf)
library(ggthemes)
library(RColorBrewer)
```

Now we need to pull our data from csv form
```{r load data}
car_existing <- read_csv(
  here("assignment rmd docs","a5",
  "car_access_existing.csv")
  ) %>%
  select(from_id, accessibility) %>%
  mutate(from_id = as.character(from_id)) %>%
  rename("car_access" = accessibility)

bike_existing <- read_csv(
  here("assignment rmd docs","a5",
  "bike_access_existing.csv")
  ) %>%
  select(from_id, accessibility) %>%
  mutate(from_id = as.character(from_id)) %>%
  rename("bike_access" = accessibility)

walk_existing <- read_csv(
  here("assignment rmd docs","a5",
  "walk_access_existing.csv")
  ) %>%
  select(from_id, accessibility) %>%
  mutate(from_id = as.character(from_id)) %>%
  rename("walk_access" = accessibility)

transit_existing <- read_csv(
  here("assignment rmd docs","a5",
  "transit_access_existing.csv")
  ) %>%
  select(from_id, accessibility) %>%
  mutate(from_id = as.character(from_id)) %>%
  rename("transit_access" = accessibility)

#Now the alts
car_alt <- read_csv(
  here("assignment rmd docs","a5",
  "car_access_alt.csv")
  ) %>%
  select(from_id, accessibility) %>%
  mutate(from_id = as.character(from_id)) %>%
  rename("car_access" = accessibility)

bike_alt <- read_csv(
  here("assignment rmd docs","a5",
  "bike_access_alt.csv")
  ) %>%
  select(from_id, accessibility) %>%
  mutate(from_id = as.character(from_id)) %>%
  rename("bike_access" = accessibility)

walk_alt <- read_csv(
  here("assignment rmd docs","a5",
  "walk_access_alt.csv")
  ) %>%
  select(from_id, accessibility) %>%
  mutate(from_id = as.character(from_id)) %>%
  rename("walk_access" = accessibility)

transit_alt <- read_csv(
  here("assignment rmd docs","a5",
  "transit_access_alt.csv")
  ) %>%
  select(from_id, accessibility) %>%
  mutate(from_id = as.character(from_id)) %>%
  rename("transit_access" = accessibility)

#Now the ratios
access_compare_existing = read_csv(here("existing", 
                                      "data",
                                      "access_compare.csv")) %>%
  select(GEOID, ratio) %>%
  mutate(GEOID = as.character(GEOID)) %>%
  rename("car_trans_ratio" = ratio)

access_compare_alt = read_csv(here("alternative", 
                                      "data",
                                      "access_compare.csv")) %>%
  select(GEOID, ratio) %>%
  mutate(GEOID = as.character(GEOID)) %>%
  rename("car_trans_ratio" = ratio)
```
```{r join tables}
all_access_existing <- left_join(car_existing, bike_existing) %>%
  left_join(walk_existing) %>%
  left_join(transit_existing) %>%
  left_join(access_compare_existing, by = c("from_id" = "GEOID"))

all_access_alt <- left_join(car_alt, bike_alt) %>%
  left_join(walk_alt) %>%
  left_join(transit_alt) %>%
  left_join(access_compare_alt, by = c("from_id" = "GEOID"))
```
```{r join with spatial data}
zones <- st_read(here("zones", "boundaries.geojson"))

all_access_existing <- left_join(zones, 
                                 all_access_existing, 
                                 by = c("GEOID" = "from_id"))
  
all_access_alt <- left_join(zones,
                            all_access_alt,
                            by = c("GEOID" = "from_id"))
```


##Map notes
Alright, here are the maps we need, at minimum:
Chloropeth maps for accessibility by tract for each mode for each network condition
(8 maps minimum)
Plus maps that show transit/car ratio
Total 10 maps

Any more maps as we think of them

Graphs?
Histograms
Transit/car ratio vs. car accessibility

Should we have an absolute scale that holds across modes?

```{r}
map_palette <- brewer.pal(5, "YlOrBr")

car_access_ex <- ggplot(all_access_existing) +
  geom_sf(aes(fill = car_access),
          color = NA) +
  scale_fill_gradientn(colours = map_palette,
                       name = "Job Accessibility \nby Driving (Existing)",
                       breaks = size_brks <- seq(0, 1000000, by = 200000),
                       labels = formatC(size_brks, format = "d", big.mark = ",")) +
  theme_void()

car_access_ex

# ggsave("ex_trans_times_tract2.png",
#        path = here("images",
#                    "a4"),
#        width = 7.5,
#        height = 7.5,
#        units = "in")
```
```{r}
trans_access_ex <- ggplot(all_access_existing) +
  geom_sf(aes(fill = transit access),
          color = NA) +
  scale_fill_gradientn(colours = map_palette,
                       name = "Job Accessibility \nby Transit (Existing)",
                       breaks = size_brks <- seq(0, 1000000, by = 200000),
                       labels = formatC(size_brks, format = "d", big.mark = ",")) +
  theme_void()

trans_access_ex

# ggsave("ex_trans_times_tract2.png",
#        path = here("images",
#                    "a4"),
#        width = 7.5,
#        height = 7.5,
#        units = "in")
```

```{r}
car_access_alt <- ggplot(all_access_alt) +
  geom_sf(aes(fill = car_access),
          color = NA) +
  scale_fill_gradientn(colours = map_palette,
                       name = "Job Accessibility \nby Driving (Alternative)",
                       breaks = size_brks <- seq(0, 1000000, by = 200000),
                       labels = formatC(size_brks, format = "d", big.mark = ",")) +
  theme_void()

car_access_alt

# ggsave("ex_trans_times_tract2.png",
#        path = here("images",
#                    "a4"),
#        width = 7.5,
#        height = 7.5,
#        units = "in")
```
```{r}
car_access_alt <- ggplot(all_access_alt) +
  geom_sf(aes(fill = car_access),
          color = NA) +
  scale_fill_gradientn(colours = map_palette,
                       name = "Job Accessibility \nby Driving (Alternative)",
                       breaks = size_brks <- seq(0, 1000000, by = 200000),
                       labels = formatC(size_brks, format = "d", big.mark = ",")) +
  theme_void()

car_access_alt

# ggsave("ex_trans_times_tract2.png",
#        path = here("images",
#                    "a4"),
#        width = 7.5,
#        height = 7.5,
#        units = "in")
```


